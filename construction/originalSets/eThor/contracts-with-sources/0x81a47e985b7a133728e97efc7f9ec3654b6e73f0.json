{"SourceCode":"pragma solidity ^0.4.8;\r\n\r\ncontract Omnipurse {\r\n\r\n  struct Contribution {\r\n    address sender;\r\n    uint value;\r\n    bool refunded;\r\n    uint256 timestamp;\r\n  }\r\n\r\n  struct Purse {\r\n    address creator;\r\n    uint256 timestamp;\r\n    string title;\r\n    uint8 status;\r\n    uint numContributions;\r\n    uint totalContributed;\r\n    mapping (uint => Contribution) contributions;\r\n  }\r\n\r\n  uint public numPurse;\r\n  mapping (uint => Purse) purses;\r\n  mapping (address => uint[]) pursesByCreator;\r\n  mapping (address => string) nicknames;\r\n\r\n  function searchPursesByAddress(address creator) constant returns (uint[] ids) {\r\n    ids = pursesByCreator[creator];\r\n  }\r\n\r\n  function getPurseDetails(uint purseId) constant returns (\r\n    address creator,\r\n    uint256 timestamp,\r\n    string title,\r\n    uint8 status,\r\n    uint numContributions,\r\n    uint totalContributed\r\n  ) {\r\n    Purse p = purses[purseId];\r\n    creator = p.creator;\r\n    timestamp = p.timestamp;\r\n    title = p.title;\r\n    status = p.status;\r\n    numContributions = p.numContributions;\r\n    totalContributed = p.totalContributed;\r\n  }\r\n\r\n  function getPurseContributions(uint purseId, uint contributionId) constant returns (\r\n    address sender,\r\n    uint value,\r\n    bool refunded,\r\n    string nickname,\r\n    uint timestamp\r\n  ) {\r\n    Purse p = purses[purseId];\r\n    Contribution c = p.contributions[contributionId];\r\n    sender = c.sender;\r\n    value = c.value;\r\n    refunded = c.refunded;\r\n    nickname = nicknames[c.sender];\r\n    timestamp = c.timestamp;\r\n  }\r\n\r\n  function createPurse(string title) returns (uint purseId) {\r\n    purseId = numPurse++;\r\n    purses[purseId] = Purse(msg.sender, block.timestamp, title, 1, 0, 0);\r\n    pursesByCreator[msg.sender].push(purseId);\r\n  }\r\n\r\n  function contributeToPurse(uint purseId) payable {\r\n    Purse p = purses[purseId];\r\n    if (p.status != 1) { throw; }\r\n    p.totalContributed += msg.value;\r\n    p.contributions[p.numContributions++] = Contribution(msg.sender, msg.value,\r\n                                                        false, block.timestamp);\r\n  }\r\n\r\n  function dissmisPurse(uint purseId) {\r\n    Purse p = purses[purseId];\r\n    if (p.creator != msg.sender || (p.status != 1 && p.status != 4)) { throw; }\r\n    bool success = true;\r\n    for (uint i=0; i<p.numContributions; i++) {\r\n      Contribution c = p.contributions[i];\r\n      if(!c.refunded) {\r\n        c.refunded = c.sender.send(c.value);\r\n      }\r\n      success = success && c.refunded;\r\n    }\r\n    p.status = success ? 3 : 4;\r\n  }\r\n\r\n  function finishPurse(uint purseId) {\r\n    Purse p = purses[purseId];\r\n    if (p.creator != msg.sender || p.status != 1) { throw; }\r\n    if (p.creator.send(p.totalContributed)) { p.status = 2; }\r\n  }\r\n\r\n  function registerNickname(string nickname) {\r\n    nicknames[msg.sender] = nickname;\r\n  }\r\n\r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"numPurse\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"purseId\",\"type\":\"uint256\"}],\"name\":\"finishPurse\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"nickname\",\"type\":\"string\"}],\"name\":\"registerNickname\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"purseId\",\"type\":\"uint256\"}],\"name\":\"contributeToPurse\",\"outputs\":[],\"payable\":true,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"purseId\",\"type\":\"uint256\"}],\"name\":\"dissmisPurse\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"creator\",\"type\":\"address\"}],\"name\":\"searchPursesByAddress\",\"outputs\":[{\"name\":\"ids\",\"type\":\"uint256[]\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"title\",\"type\":\"string\"}],\"name\":\"createPurse\",\"outputs\":[{\"name\":\"purseId\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"purseId\",\"type\":\"uint256\"}],\"name\":\"getPurseDetails\",\"outputs\":[{\"name\":\"creator\",\"type\":\"address\"},{\"name\":\"timestamp\",\"type\":\"uint256\"},{\"name\":\"title\",\"type\":\"string\"},{\"name\":\"status\",\"type\":\"uint8\"},{\"name\":\"numContributions\",\"type\":\"uint256\"},{\"name\":\"totalContributed\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"purseId\",\"type\":\"uint256\"},{\"name\":\"contributionId\",\"type\":\"uint256\"}],\"name\":\"getPurseContributions\",\"outputs\":[{\"name\":\"sender\",\"type\":\"address\"},{\"name\":\"value\",\"type\":\"uint256\"},{\"name\":\"refunded\",\"type\":\"bool\"},{\"name\":\"nickname\",\"type\":\"string\"},{\"name\":\"timestamp\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"}]","ContractName":"Omnipurse","CompilerVersion":"v0.4.8+commit.60cc1668","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"","LicenseType":"","SwarmSource":"bzzr://5be45485113cc69881ae90239eefb7bee060e7402233d99d39ecf0e652b55fd8"}
