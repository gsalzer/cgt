{"SourceCode":"contract AbstractStarbaseCrowdsale {\r\n    function startDate() constant returns (uint256 startDate) {}\r\n}\r\n\r\n/// @title EarlyPurchase contract - Keep track of purchased amount by Early Purchasers\r\n/// @author Starbase PTE. LTD. - <info@starbase.co>\r\ncontract StarbaseEarlyPurchase {\r\n    /*\r\n     *  Constants\r\n     */\r\n    string public constant PURCHASE_AMOUNT_UNIT = 'CNY';    // Chinese Yuan\r\n    string public constant PURCHASE_AMOUNT_RATE_REFERENCE = 'http://www.xe.com/currencytables/';\r\n    uint public constant PURCHASE_AMOUNT_CAP = 9000000;\r\n\r\n    /*\r\n     *  Types\r\n     */\r\n    struct EarlyPurchase {\r\n        address purchaser;\r\n        uint amount;        // CNY based amount\r\n        uint purchasedAt;   // timestamp\r\n    }\r\n\r\n    /*\r\n     *  External contracts\r\n     */\r\n    AbstractStarbaseCrowdsale public starbaseCrowdsale;\r\n\r\n    /*\r\n     *  Storage\r\n     */\r\n    address public owner;\r\n    EarlyPurchase[] public earlyPurchases;\r\n    uint public earlyPurchaseClosedAt;\r\n\r\n    /*\r\n     *  Modifiers\r\n     */\r\n    modifier noEther() {\r\n        if (msg.value > 0) {\r\n            throw;\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier onlyOwner() {\r\n        if (msg.sender != owner) {\r\n            throw;\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier onlyBeforeCrowdsale() {\r\n        if (address(starbaseCrowdsale) != 0 &&\r\n            starbaseCrowdsale.startDate() > 0)\r\n        {\r\n            throw;\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier onlyEarlyPurchaseTerm() {\r\n        if (earlyPurchaseClosedAt > 0) {\r\n            throw;\r\n        }\r\n        _;\r\n    }\r\n\r\n    /*\r\n     *  Contract functions\r\n     */\r\n    /// @dev Returns early purchased amount by purchaser's address\r\n    /// @param purchaser Purchaser address\r\n    function purchasedAmountBy(address purchaser)\r\n        external\r\n        constant\r\n        noEther\r\n        returns (uint amount)\r\n    {\r\n        for (uint i; i < earlyPurchases.length; i++) {\r\n            if (earlyPurchases[i].purchaser == purchaser) {\r\n                amount += earlyPurchases[i].amount;\r\n            }\r\n        }\r\n    }\r\n\r\n    /// @dev Returns total amount of raised funds by Early Purchasers\r\n    function totalAmountOfEarlyPurchases()\r\n        constant\r\n        noEther\r\n        returns (uint totalAmount)\r\n    {\r\n        for (uint i; i < earlyPurchases.length; i++) {\r\n            totalAmount += earlyPurchases[i].amount;\r\n        }\r\n    }\r\n\r\n    /// @dev Returns number of early purchases\r\n    function numberOfEarlyPurchases()\r\n        external\r\n        constant\r\n        noEther\r\n        returns (uint)\r\n    {\r\n        return earlyPurchases.length;\r\n    }\r\n\r\n    /// @dev Append an early purchase log\r\n    /// @param purchaser Purchaser address\r\n    /// @param amount Purchase amount\r\n    /// @param purchasedAt Timestamp of purchased date\r\n    function appendEarlyPurchase(address purchaser, uint amount, uint purchasedAt)\r\n        external\r\n        noEther\r\n        onlyOwner\r\n        onlyBeforeCrowdsale\r\n        onlyEarlyPurchaseTerm\r\n        returns (bool)\r\n    {\r\n        if (amount == 0 ||\r\n            totalAmountOfEarlyPurchases() + amount > PURCHASE_AMOUNT_CAP)\r\n        {\r\n            return false;\r\n        }\r\n\r\n        if (purchasedAt == 0 || purchasedAt > now) {\r\n            throw;\r\n        }\r\n\r\n        earlyPurchases.push(EarlyPurchase(purchaser, amount, purchasedAt));\r\n        return true;\r\n    }\r\n\r\n    /// @dev Close early purchase term\r\n    function closeEarlyPurchase()\r\n        external\r\n        noEther\r\n        onlyOwner\r\n        returns (bool)\r\n    {\r\n        earlyPurchaseClosedAt = now;\r\n    }\r\n\r\n    /// @dev Setup function sets external contract's address\r\n    /// @param starbaseCrowdsaleAddress Token address\r\n    function setup(address starbaseCrowdsaleAddress)\r\n        external\r\n        noEther\r\n        onlyOwner\r\n        returns (bool)\r\n    {\r\n        if (address(starbaseCrowdsale) == 0) {\r\n            starbaseCrowdsale = AbstractStarbaseCrowdsale(starbaseCrowdsaleAddress);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /// @dev Contract constructor function\r\n    function StarbaseEarlyPurchase() noEther {\r\n        owner = msg.sender;\r\n    }\r\n\r\n    /// @dev Fallback function always fails\r\n    function () {\r\n        throw;\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"earlyPurchases\",\"outputs\":[{\"name\":\"purchaser\",\"type\":\"address\"},{\"name\":\"amount\",\"type\":\"uint256\"},{\"name\":\"purchasedAt\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"earlyPurchaseClosedAt\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"numberOfEarlyPurchases\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"purchaser\",\"type\":\"address\"}],\"name\":\"purchasedAmountBy\",\"outputs\":[{\"name\":\"amount\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"PURCHASE_AMOUNT_CAP\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"starbaseCrowdsaleAddress\",\"type\":\"address\"}],\"name\":\"setup\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"starbaseCrowdsale\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"purchaser\",\"type\":\"address\"},{\"name\":\"amount\",\"type\":\"uint256\"},{\"name\":\"purchasedAt\",\"type\":\"uint256\"}],\"name\":\"appendEarlyPurchase\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"closeEarlyPurchase\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalAmountOfEarlyPurchases\",\"outputs\":[{\"name\":\"totalAmount\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"PURCHASE_AMOUNT_RATE_REFERENCE\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"PURCHASE_AMOUNT_UNIT\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"type\":\"constructor\"},{\"payable\":false,\"type\":\"fallback\"}]","ContractName":"StarbaseEarlyPurchase","CompilerVersion":"v0.4.7+commit.822622cf","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","Library":"","LicenseType":"","SwarmSource":"bzzr://86a3d7d337e5aa342dc9385b2807158d8e202371f1af4f24d1d2c7adc8c1d360"}
